name: Linux
on:
  push:
jobs:
  python3_12:
    runs-on: ubuntu-latest
    container:
      image: almalinux:8
    steps:
      - name: Install dependencies
        run: dnf install -y git python3.12-pip gcc-c++ python3.12-devel
      - uses: actions/checkout@v4
        with:
          persist-credentials: false
      - name: Run tests
        run: |
          alternatives --set python /usr/bin/python3
          pip3 install -r requirements.txt
          pip3 install pytest
          pytest
  python3_13:
    runs-on: ubuntu-latest
    container:
      image: fedora:42
    steps:
      - name: Install dependencies
        run: dnf install -y git python3-pytest python3-pip gcc-c++ python3-devel
      - uses: actions/checkout@v4
        with:
          persist-credentials: false
      - name: Run tests
        run: |
          pip install -r requirements.txt
          pytest
  python3_14:
    runs-on: ubuntu-latest
    container:
      image: fedora:43
    steps:
      - name: Install dependencies
        run: dnf install -y git python3-pytest python3-pip gcc-c++ python3-devel
      - uses: actions/checkout@v4
        with:
          persist-credentials: false
      - name: Run tests
        run: |
          pip install -r requirements.txt
          pytest
  completions:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: false
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -e .
      - name: Install shells
        run: sudo apt-get update && sudo apt-get install -y bash zsh fish util-linux
      - name: Test bash completion produces no output
        run: |
          output=$(bash -c 'eval "$(lus --completions bash)"' 2>&1)
          if [ -n "$output" ]; then
            echo "Unexpected output: $output"
            exit 1
          fi
      - name: Test zsh completion produces no output
        run: |
          output=$(lus --completions zsh)
          if [ -z "$output" ]; then
            echo "No output from lus --completions zsh"
            exit 1
          fi
      - name: Test fish completion produces no output
        run: |
          output=$(fish -c 'lus --completions fish | source' 2>&1)
          if [ -n "$output" ]; then
            echo "Unexpected output: $output"
            exit 1
          fi
